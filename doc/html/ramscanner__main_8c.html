<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Ramscanner: ramscanner_main.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Ramscanner</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<h1>ramscanner_main.c File Reference</h1>  </div>
</div>
<div class="contents">
<div class="textblock"><code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="ramscanner__common_8h_source.html">ramscanner_common.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="ramscanner__collect_8h_source.html">ramscanner_collect.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="ramscanner__display_8h_source.html">ramscanner_display.h</a>&quot;</code><br/>
</div>
<p><a href="ramscanner__main_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="ramscanner__main_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main</a> (int argc, char *argv[])</td></tr>
</table>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a0ddf1224851353fc92bfbff6f499fa97"></a><!-- doxytag: member="ramscanner_main.c::main" ref="a0ddf1224851353fc92bfbff6f499fa97" args="(int argc, char *argv[])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>argv</em>[]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Sets up the signal handler. Calls functions to turn the arguments into PIDs, flags and filenames. Stops the PIDs that are going to be inspected. Calls the function to inspect the PIDs. Writes in stdout or in the files specified by the arguments. </p>

<p>Definition at line <a class="el" href="ramscanner__main_8c_source.html#l00016">16</a> of file <a class="el" href="ramscanner__main_8c_source.html">ramscanner_main.c</a>.</p>

<p>References <a class="el" href="ramscanner__common_8c_source.html#l00039">cleanup_and_exit()</a>, <a class="el" href="ramscanner__common_8h_source.html#l00079">options::compactdetail</a>, <a class="el" href="ramscanner__common_8h_source.html#l00084">options::compactdetailfile</a>, <a class="el" href="ramscanner__common_8c_source.html#l00029">destroyval()</a>, <a class="el" href="ramscanner__common_8h_source.html#l00076">options::detail</a>, <a class="el" href="ramscanner__common_8h_source.html#l00083">options::detailfile</a>, <a class="el" href="ramscanner__common_8h_source.html#l00094">options::detailpages</a>, <a class="el" href="ramscanner__common_8c_source.html#l00126">handle_args()</a>, <a class="el" href="ramscanner__collect_8c_source.html#l00518">inspect_processes()</a>, <a class="el" href="ramscanner__common_8h_source.html#l00089">options::pidcount</a>, <a class="el" href="ramscanner__common_8c_source.html#l00009">PIDcount</a>, <a class="el" href="ramscanner__common_8h_source.html#l00085">options::pids</a>, <a class="el" href="ramscanner__common_8c_source.html#l00008">PIDs</a>, <a class="el" href="ramscanner__common_8c_source.html#l00174">set_signals()</a>, <a class="el" href="ramscanner__common_8c_source.html#l00200">stop_PIDs()</a>, <a class="el" href="ramscanner__common_8h_source.html#l00073">options::summary</a>, <a class="el" href="ramscanner__common_8h_source.html#l00082">options::summaryfile</a>, <a class="el" href="ramscanner__common_8h_source.html#l00090">options::summarypages</a>, <a class="el" href="ramscanner__common_8h_source.html#l00098">options::summarystats</a>, <a class="el" href="ramscanner__common_8h_source.html#l00101">options::vmas</a>, <a class="el" href="ramscanner__display_8c_source.html#l00139">write_any_detail()</a>, and <a class="el" href="ramscanner__display_8c_source.html#l00010">write_summary()</a>.</p>
<div class="fragment"><pre class="fragment">{

        <a class="code" href="structoptions.html">options</a> opt = {0};
        <a class="code" href="ramscanner__common_8c.html#a5cdf3775ac99892eed195d27f648db78">set_signals</a>();

        <span class="keywordflow">if</span> (argc &lt; 2){
                printf(<span class="stringliteral">&quot;Usage: %s [Primary PID] [-s&lt;path&gt;] [-d&lt;path&gt;] &quot;</span>
                       <span class="stringliteral">&quot;[-D&lt;path&gt;] [Secondary PIDs]\n&quot;</span>
                       <span class="stringliteral">&quot;\t&#39;-s&lt;path&gt;&#39; to write a summary to &lt;path&gt;\n&quot;</span>
                       <span class="stringliteral">&quot;\t&#39;-D&lt;path&gt;&#39; to get per-page details\n&quot;</span>
                       <span class="stringliteral">&quot;\t&#39;-d&lt;path&gt;&#39; to get compact details\n&quot;</span>, argv[0]); 
                exit(EXIT_FAILURE);
        }

        <a class="code" href="ramscanner__common_8c.html#a70b7831ca7a3527ddcb17ecd447f4a6a">handle_args</a>(argc, argv, &amp;opt);
        <a class="code" href="ramscanner__common_8c.html#a49e9ec214eeb6326a20c2c0efb119c00">PIDs</a> = opt.<a class="code" href="structoptions.html#a3aa35d527ad06e54e301bae6f1ffe5b2">pids</a>;
        <a class="code" href="ramscanner__common_8c.html#a7821ec79c97f753be216f26ec5f5b36c">PIDcount</a> = opt.<a class="code" href="structoptions.html#af48db6b2a8fd988837b4b2e9d4d31a61">pidcount</a>;
        <a class="code" href="ramscanner__common_8c.html#a5320569320ec49e2df43d9edeb8d0c4b">stop_PIDs</a>(<a class="code" href="ramscanner__common_8c.html#a49e9ec214eeb6326a20c2c0efb119c00">PIDs</a>, <a class="code" href="ramscanner__common_8c.html#a7821ec79c97f753be216f26ec5f5b36c">PIDcount</a>);

        <span class="keywordflow">if</span> (opt.<a class="code" href="structoptions.html#aa46b832c2b73ca872baee120bb4bc755">summary</a>) {
                memset(&amp;(opt.<a class="code" href="structoptions.html#a40fbf684316fd9e0819ab090506d3c19">summarystats</a>), 0, <span class="keyword">sizeof</span>(opt.<a class="code" href="structoptions.html#a40fbf684316fd9e0819ab090506d3c19">summarystats</a>));
                opt.<a class="code" href="structoptions.html#a3f12bfa404a3402c0506d8dc52da4c4c">summarypages</a> = g_hash_table_new_full(g_int64_hash,
                                                         g_int64_equal,
                                                         &amp;<a class="code" href="ramscanner__common_8c.html#a0f8c4a01ccc1a82bb23acd71f37ec26c">destroyval</a>,
                                                         &amp;<a class="code" href="ramscanner__common_8c.html#a0f8c4a01ccc1a82bb23acd71f37ec26c">destroyval</a>);
        }
        <span class="keywordflow">if</span> (opt.<a class="code" href="structoptions.html#a57b3831a986f49e50f1746551d7c312e">detail</a> || opt.<a class="code" href="structoptions.html#aef87d29ef02ab135ff237eb2c7b9f9a7">compactdetail</a>) {
                opt.<a class="code" href="structoptions.html#a3633157dccdfa6c34ba42b290f7cab34">detailpages</a> = g_hash_table_new_full(g_int64_hash,
                                                         g_int64_equal,
                                                         &amp;<a class="code" href="ramscanner__common_8c.html#a0f8c4a01ccc1a82bb23acd71f37ec26c">destroyval</a>,
                                                         &amp;<a class="code" href="ramscanner__common_8c.html#a0f8c4a01ccc1a82bb23acd71f37ec26c">destroyval</a>);
        }

        <span class="keywordflow">if</span> (opt.<a class="code" href="structoptions.html#aa46b832c2b73ca872baee120bb4bc755">summary</a> || opt.<a class="code" href="structoptions.html#a57b3831a986f49e50f1746551d7c312e">detail</a> || opt.<a class="code" href="structoptions.html#aef87d29ef02ab135ff237eb2c7b9f9a7">compactdetail</a>)
                <a class="code" href="ramscanner__collect_8c.html#ab5dc8716f53334cd9895c210ab4c93fa">inspect_processes</a>(&amp;opt);
        <span class="keywordflow">else</span>
                printf(<span class="stringliteral">&quot;%s must specify at least one of -s and -d\n&quot;</span>, argv[0]);



        <span class="keywordflow">if</span> (opt.<a class="code" href="structoptions.html#aa46b832c2b73ca872baee120bb4bc755">summary</a>)
                <a class="code" href="ramscanner__display_8c.html#a2f6db9e51b53cf8e15c2ab0a5dbf01c2">write_summary</a>(&amp;(opt.<a class="code" href="structoptions.html#a40fbf684316fd9e0819ab090506d3c19">summarystats</a>), opt.<a class="code" href="structoptions.html#a321f0e9b55d73206578064e97770e931">summaryfile</a>);
        <span class="keywordflow">if</span> (opt.<a class="code" href="structoptions.html#a57b3831a986f49e50f1746551d7c312e">detail</a> || opt.<a class="code" href="structoptions.html#aef87d29ef02ab135ff237eb2c7b9f9a7">compactdetail</a>)
                <a class="code" href="ramscanner__display_8c.html#a9326d614591c7ef8b023773b3b2efc05">write_any_detail</a>(&amp;opt);
        <span class="keywordflow">if</span> (opt.<a class="code" href="structoptions.html#ab11cbb9c2c85d3615b4c94eed1861fa3">compactdetailfile</a> != NULL)
                fclose(opt.<a class="code" href="structoptions.html#ab11cbb9c2c85d3615b4c94eed1861fa3">compactdetailfile</a>);
        <span class="keywordflow">if</span> (opt.<a class="code" href="structoptions.html#a78251c3725838682b6ab22f4bed05c42">detailfile</a> != NULL)
                fclose(opt.<a class="code" href="structoptions.html#a78251c3725838682b6ab22f4bed05c42">detailfile</a>);
        <span class="keywordflow">if</span> (opt.<a class="code" href="structoptions.html#a321f0e9b55d73206578064e97770e931">summaryfile</a> != NULL)
                fclose(opt.<a class="code" href="structoptions.html#a321f0e9b55d73206578064e97770e931">summaryfile</a>);


        free(opt.<a class="code" href="structoptions.html#a694f66a9718a83a7948aeba212945e4f">vmas</a>);
        <span class="keywordflow">if</span> (opt.<a class="code" href="structoptions.html#aa46b832c2b73ca872baee120bb4bc755">summary</a>)
                g_hash_table_destroy(opt.<a class="code" href="structoptions.html#a3f12bfa404a3402c0506d8dc52da4c4c">summarypages</a>);
        <span class="keywordflow">if</span> (opt.<a class="code" href="structoptions.html#a57b3831a986f49e50f1746551d7c312e">detail</a> || opt.<a class="code" href="structoptions.html#aef87d29ef02ab135ff237eb2c7b9f9a7">compactdetail</a>)
                g_hash_table_destroy(opt.<a class="code" href="structoptions.html#a3633157dccdfa6c34ba42b290f7cab34">detailpages</a>);

        <a class="code" href="ramscanner__common_8c.html#a9a3df3681470f93c9cbf201fb3e62795">cleanup_and_exit</a>(EXIT_SUCCESS);
        <span class="comment">/* free(PIDs); This function cannot be called because cleanup_and_exit() </span>
<span class="comment">         *  must happen before that, and it exits. It cannot be called within</span>
<span class="comment">         *  cleanup_and_exit because free() isn&#39;t async-signal safe.</span>
<span class="comment">         */</span>
        exit(EXIT_SUCCESS); <span class="comment">/* This should never happen, cleanup_and_exit exits.</span>
<span class="comment">                             */</span>
}
</pre></div>
</div>
</div>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Thu Mar 1 2012 13:27:38 for Ramscanner by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </small></address>
</body>
</html>
